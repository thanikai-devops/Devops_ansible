@Library ("my_shared_library") _

pipeline {
    agent {
        label "JenkinsWorker"
    }
    environment {
        ECR_REPOS = "829173323501.dkr.ecr.ap-south-1.amazonaws.com/sciflare-website"  // Your ECR repository URL
        BUILD_NUMER = "${env.BUILD_NUMBER}"
        AWS_REGION = 'ap-south-1'
        // DOCKERPATH = "Dockerfile"
        PLAYBOOK = "../playbook/astro/deploy.yml"
    }
    stages {
        stage("Scm") {
            steps {
                script {
                    // Ensure that the credentialsId is properly substituted
                    checkoutCode.scmcheckout("https://SciflareIT@bitbucket.org/web-sciflare/sciflare-website.git", "dev_dafin")

                }
            }
        }
        stage("Build Docker Image & Push to AWS ECR"){
            steps{
                script{ 
                    build.ecrLoginBuildAndPush(AWS_REGION, ECR_REPOS, BUILD_NUMBER)
                }
            }
        }
        stage("Ansible Deployment"){
            steps{
                script{
                    deploy.ansibledeploymentIntoServer(PLAYBOOK)
                }
            }
        }
    }
}
